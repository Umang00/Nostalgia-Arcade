var A=Object.defineProperty;var P=(n,s,t)=>s in n?A(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var r=(n,s,t)=>P(n,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function C(n){let s=null;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),s=t,n&&n.classList.remove("hidden")}),n?.addEventListener("click",async()=>{s&&(s.prompt(),await s.userChoice,s=null,n?.classList.add("hidden"))})}const L={};function B(n){Object.assign(L,n),window.addEventListener("popstate",()=>{S(location.pathname+location.search,!1)}),document.addEventListener("click",s=>{const t=s.target;if(t&&t.closest){const e=t.closest('a[href^="/"]');e&&(s.preventDefault(),S(e.getAttribute("href"),!0))}})}function F(n){for(const s in L){const t=[],e=new RegExp("^"+s.replace(/:[^/]+/g,a=>(t.push(a.slice(1)),"([^/]+)"))+"$"),i=n.match(e);if(i){const a={};return t.forEach((o,c)=>a[o]=decodeURIComponent(i[c+1])),{handler:L[s],params:a}}}return{params:{}}}function S(n,s=!0){const[t]=n.split("?"),{handler:e,params:i}=F(t);s&&history.pushState({},"",n),e?e(i):L["/"]?.({})}const D=[{id:"snake",name:"Snake",tagline:"Classic Nokia vibes"},{id:"tetris",name:"Tetris",tagline:"Stack & clear lines"},{id:"pong",name:"Pong",tagline:"Retro paddle duel"},{id:"brick",name:"Brick Breaker",tagline:"Smash those bricks"}];function T(){const n=document.getElementById("route-root");n.innerHTML=`
    <h1 style="margin:8px 0 12px 0;">All your childhood games, one link.</h1>
    <div class="grid">
      ${D.map(s=>`
        <div class="card">
          <div style="font-weight:600;">${s.name}</div>
          <div class="pill">${s.tagline}</div>
          <button class="btn" data-game="${s.id}">Play</button>
        </div>
      `).join("")}
    </div>
  `,n.querySelectorAll("button[data-game]").forEach(s=>{s.addEventListener("click",()=>{const t=s.dataset.game;S(`/game/${t}`)})})}class M{constructor(){r(this,"listeners",{score:[],game_over:[],share_payload:[]});r(this,"container")}on(s,t){this.listeners[s].push(t)}emit(s,...t){this.listeners[s].forEach(e=>e(...t))}init(s){this.container=s}}class w extends M{constructor(){super(...arguments);r(this,"canvas");r(this,"ctx");r(this,"grid",20);r(this,"snake",[]);r(this,"dir",{x:1,y:0});r(this,"food",{x:10,y:10});r(this,"raf",0);r(this,"last",0);r(this,"speedMs",120);r(this,"paused",!1);r(this,"alive",!0);r(this,"onVirtualDir",t=>{const e=t.detail;this.applyDir(e)});r(this,"handleKeys",t=>{["ArrowUp","KeyW"].includes(t.code)?this.applyDir("up"):["ArrowDown","KeyS"].includes(t.code)?this.applyDir("down"):["ArrowLeft","KeyA"].includes(t.code)?this.applyDir("left"):["ArrowRight","KeyD"].includes(t.code)?this.applyDir("right"):t.code==="Space"&&(this.paused?this.resume():this.pause())})}init(t){super.init(t),this.canvas=document.createElement("canvas"),this.canvas.className="game-canvas",this.ctx=this.canvas.getContext("2d"),t.innerHTML="",t.appendChild(this.canvas),this.onResize(),addEventListener("resize",()=>this.onResize()),this.reset(),addEventListener("keydown",this.handleKeys),addEventListener("virtual-direction",this.onVirtualDir)}applyDir(t){const e={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[t];this.snake.length>1&&this.dir.x+e.x===0&&this.dir.y+e.y===0||(this.dir=e)}onResize(){const t=this.container.getBoundingClientRect(),e=Math.min(t.width,t.height);this.canvas.width=Math.floor(e),this.canvas.height=Math.floor(e)}start(){this.paused=!1,this.alive=!0,this.last=0,cancelAnimationFrame(this.raf);const t=e=>{this.raf=requestAnimationFrame(t),!(this.paused||!this.alive)&&(this.last||(this.last=e),e-this.last>this.speedMs&&(this.step(),this.last=e,this.draw()))};this.raf=requestAnimationFrame(t)}pause(){this.paused=!0}resume(){this.paused=!1}reset(){this.snake=[{x:5,y:5},{x:4,y:5},{x:3,y:5}],this.dir={x:1,y:0},this.randomFood(),this.alive=!0,this.draw()}destroy(){cancelAnimationFrame(this.raf),removeEventListener("keydown",this.handleKeys),removeEventListener("virtual-direction",this.onVirtualDir),this.container.innerHTML=""}cellsX(){return Math.floor(this.canvas.width/this.grid)}cellsY(){return Math.floor(this.canvas.height/this.grid)}randomFood(){this.food={x:Math.floor(Math.random()*this.cellsX()),y:Math.floor(Math.random()*this.cellsY())}}step(){const t={x:this.snake[0].x+this.dir.x,y:this.snake[0].y+this.dir.y};if(t.x=(t.x+this.cellsX())%this.cellsX(),t.y=(t.y+this.cellsY())%this.cellsY(),this.snake.some((e,i)=>i>0&&e.x===t.x&&e.y===t.y)){this.alive=!1,this.emit("game_over");return}this.snake.unshift(t),t.x===this.food.x&&t.y===this.food.y?(this.emit("score",10),this.randomFood()):this.snake.pop()}draw(){const t=this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#0f1220",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#f59e0b",t.fillRect(this.food.x*this.grid,this.food.y*this.grid,this.grid-1,this.grid-1),t.fillStyle="#60a5fa";for(const e of this.snake)t.fillRect(e.x*this.grid,e.y*this.grid,this.grid-1,this.grid-1)}}const H={I:{name:"I",color:"#60a5fa",cells:[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0}]},O:{name:"O",color:"#fbbf24",cells:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]},T:{name:"T",color:"#a78bfa",cells:[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1}]},S:{name:"S",color:"#34d399",cells:[{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1}]},Z:{name:"Z",color:"#f87171",cells:[{x:-1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1}]},J:{name:"J",color:"#60a5fa",cells:[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:1}]},L:{name:"L",color:"#f59e0b",cells:[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:1,y:1}]}};function k(n){return H[n]}function W(n,s){if(s==="O")return n.map(e=>({...e}));const t=new Array(n.length);for(let e=0;e<n.length;e++){const i=n[e];t[e]={x:i.y,y:-i.x}}return t}const N=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1}];class R{constructor(){r(this,"queue",[])}next(){return this.queue.length===0&&this.refill(),this.queue.pop()}peekNext(){return this.queue.length===0&&this.refill(),this.queue[this.queue.length-1]}refill(){const s=["I","O","T","S","Z","J","L"];for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}this.queue.push(...s)}}const O=[0,100,300,500,800];function G(n){return O[n]||0}function q(n){return n*2}function K(n,s,t){const e=s+t;return{level:Math.floor(e/10),totalLines:e}}function _(n){const i=800-85*Math.max(0,n);return Math.max(120,i)}class $ extends M{constructor(){super(...arguments);r(this,"canvas");r(this,"ctx");r(this,"boardW",10);r(this,"boardH",20);r(this,"hiddenRows",2);r(this,"grid",24);r(this,"board",[]);r(this,"bag",new R);r(this,"active");r(this,"nextShape");r(this,"raf",0);r(this,"lastFrame",0);r(this,"lastGravity",0);r(this,"running",!1);r(this,"paused",!1);r(this,"over",!1);r(this,"level",0);r(this,"totalLines",0);r(this,"score",0);r(this,"touchRotateListener",t=>{this.rotate()});r(this,"onVirtual",t=>{const e=t.detail;e==="left"?this.move(-1):e==="right"?this.move(1):e==="down"&&this.softDrop()});r(this,"onKey",t=>{t.code==="ArrowLeft"?this.move(-1):t.code==="ArrowRight"?this.move(1):t.code==="ArrowDown"?this.softDrop():t.code==="ArrowUp"?this.rotate():t.code==="Space"?this.hardDrop():t.code==="KeyP"&&(this.paused?this.resume():this.pause())})}init(t){super.init(t),this.canvas=document.createElement("canvas"),this.canvas.className="game-canvas",this.ctx=this.canvas.getContext("2d"),t.innerHTML="",t.appendChild(this.canvas),this.onResize(),addEventListener("resize",()=>this.onResize()),addEventListener("keydown",this.onKey),addEventListener("virtual-direction",this.onVirtual),this.canvas.addEventListener("click",this.touchRotateListener),this.reset()}start(){if(this.running)return;this.paused=!1,this.over=!1,this.running=!0,cancelAnimationFrame(this.raf),this.lastFrame=0,this.lastGravity=0;const t=e=>{if(this.raf=requestAnimationFrame(t),this.paused||this.over)return;if(!this.lastFrame){this.lastFrame=e,this.lastGravity=e,this.draw();return}const i=_(this.level);e-this.lastGravity>=i&&(this.tryMove(0,1)||this.lockPiece(),this.lastGravity=e),e-this.lastFrame>=16&&(this.draw(),this.lastFrame=e)};this.raf=requestAnimationFrame(t)}pause(){this.running&&(this.paused=!0)}resume(){this.running&&(this.paused=!1)}reset(){const t=this.boardH+this.hiddenRows;this.board=new Array(t);for(let e=0;e<t;e++){const i=new Array(this.boardW);for(let a=0;a<this.boardW;a++)i[a]={filled:!1,color:"#000000"};this.board[e]=i}this.level=0,this.totalLines=0,this.score=0,this.bag=new R,this.nextShape=this.bag.next(),this.spawn(),this.running=!1,this.over=!1,this.paused=!1,this.draw()}destroy(){cancelAnimationFrame(this.raf),removeEventListener("keydown",this.onKey),removeEventListener("virtual-direction",this.onVirtual),this.canvas.removeEventListener("click",this.touchRotateListener),this.container.innerHTML="",this.running=!1}onResize(){const t=this.container.getBoundingClientRect(),e=Math.floor(Math.min(t.width/this.boardW,t.height/this.boardH)),i=e*this.boardW,a=e*this.boardH;this.canvas.width=i,this.canvas.height=a,this.grid=e;const o=this.container;o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center"}spawn(){const t=this.nextShape;this.nextShape=this.bag.next();const e=k(t);this.active={shape:t,cells:e.cells.map(i=>({...i})),x:Math.floor(this.boardW/2),y:0,color:e.color},this.collides(this.active,0,0)&&this.gameOver()}gameOver(){this.over=!0,this.running=!1,this.emit("game_over")}tryMove(t,e){return this.collides(this.active,t,e)?!1:(this.active.x+=t,this.active.y+=e,!0)}move(t){this.tryMove(t,0)}rotate(){const t=W(this.active.cells,this.active.shape),e={...this.active,cells:t};for(const i of N)if(!this.collides(e,i.x,i.y)){this.active.cells=t,this.active.x+=i.x,this.active.y+=i.y;return}}softDrop(){!this.over&&!this.paused&&(this.tryMove(0,1)?(this.incrementScore(1),this.lastGravity=performance.now()):this.lockPiece())}hardDrop(){if(this.over||this.paused)return;let t=0;for(;this.tryMove(0,1);)t++;t>0&&this.incrementScore(q(t)),this.lockPiece()}incrementScore(t){t<=0||(this.score+=t,this.emit("score",t))}lockPiece(){const t=this.active;for(const i of t.cells){const a=t.x+i.x,o=t.y+i.y;o<0||o>=this.board.length||a<0||a>=this.boardW||(this.board[o][a]={filled:!0,color:t.color})}const e=this.clearLines();if(e>0){const i=G(e);this.incrementScore(i);const a=K(this.level,this.totalLines,e);this.level=a.level,this.totalLines=a.totalLines}this.spawn()}clearLines(){let t=0;for(let e=this.board.length-1;e>=0;e--)this.isLineFull(e)&&(this.removeLine(e),t++,e++);return t}isLineFull(t){for(let e=0;e<this.boardW;e++)if(!this.board[t][e].filled)return!1;return!0}removeLine(t){for(let e=t;e>0;e--)for(let i=0;i<this.boardW;i++)this.board[e][i]={...this.board[e-1][i]};for(let e=0;e<this.boardW;e++)this.board[0][e]={filled:!1,color:"#000000"}}collides(t,e,i){for(const a of t.cells){const o=t.x+a.x+e,c=t.y+a.y+i;if(o<0||o>=this.boardW||c>=this.board.length||c>=0&&this.board[c][o].filled)return!0}return!1}computeGhostY(){const t={...this.active,cells:this.active.cells.map(i=>({...i}))};let e=t.y;for(;!this.collides(t,0,1);)t.y++,e=t.y;return e}draw(){const t=this.ctx,e=this.canvas.width,i=this.canvas.height;t.clearRect(0,0,e,i),t.fillStyle="#0f1220",t.fillRect(0,0,e,i),this.hiddenRows*this.grid,t.strokeStyle="rgba(255,255,255,0.06)",t.lineWidth=1;for(let l=0;l<=this.boardW;l++)t.beginPath(),t.moveTo(l*this.grid+.5,.5),t.lineTo(l*this.grid+.5,this.boardH*this.grid+.5),t.stroke();for(let l=0;l<=this.boardH;l++)t.beginPath(),t.moveTo(.5,l*this.grid+.5),t.lineTo(this.boardW*this.grid+.5,l*this.grid+.5),t.stroke();for(let l=this.hiddenRows;l<this.board.length;l++)for(let h=0;h<this.boardW;h++){const u=this.board[l][h];u.filled&&(t.fillStyle=u.color,t.fillRect(h*this.grid,(l-this.hiddenRows)*this.grid,this.grid-1,this.grid-1))}const a=this.computeGhostY();t.fillStyle="rgba(255,255,255,0.12)";for(const l of this.active.cells){const h=(this.active.x+l.x)*this.grid,u=(a+l.y-this.hiddenRows)*this.grid;a+l.y>=this.hiddenRows&&t.fillRect(h,u,this.grid-1,this.grid-1)}t.fillStyle=this.active.color;for(const l of this.active.cells){const h=(this.active.x+l.x)*this.grid,u=(this.active.y+l.y-this.hiddenRows)*this.grid;this.active.y+l.y>=this.hiddenRows&&t.fillRect(h,u,this.grid-1,this.grid-1)}const o=Math.max(10,this.grid-8),c=6,m=e-o*4-c,f=c;t.fillStyle="rgba(255,255,255,0.05)",t.fillRect(m,f,o*4,o*4);const p=k(this.nextShape);t.fillStyle=p.color;const v=m+o*2,x=f+o*2;for(const l of p.cells){const h=v+l.x*o-o/2,u=x+l.y*o-o/2;t.fillRect(h,u,o-2,o-2)}}}function Y(n){switch(n){case"snake":return new w;case"tetris":return new $;case"pong":return new w;case"brick":return new w;default:return new w}}function E(n,s={}){console.log("[analytics]",n,s);const t=window;t.plausible&&t.plausible(n,{props:s})}function z(n){const s=n?.id||"snake",t=document.getElementById("route-root");t.innerHTML=`
    <a class="btn secondary" href="/">‚Üê Back</a>
    <div style="margin-top:10px;"></div>
    <div id="game-wrap" class="card" style="height:70vh; display:flex; flex-direction:column;">
      <div id="hud" style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px;">
        <div>Score: <span id="score">0</span></div>
        <div>Best: <span id="best">0</span></div>
        <div class="controls">
          <button id="btnPause" class="btn secondary">Pause</button>
          <button id="btnReset" class="btn secondary">Reset</button>
        </div>
      </div>
      <div id="canvasHost" style="flex:1; position:relative;"></div>
      <div id="touchControls" class="controls" style="justify-content:center; margin-top:8px;">
        <button class="btn secondary" data-dir="up">‚Üë</button>
        <div>
          <button class="btn secondary" data-dir="left">‚Üê</button>
          <button class="btn secondary" data-dir="right">‚Üí</button>
        </div>
        <button class="btn secondary" data-dir="down">‚Üì</button>
      </div>
    </div>
    <div id="endModal" class="card hidden">
      <div style="font-weight:600;">Game Over</div>
      <div>Final Score: <span id="finalScore">0</span></div>
      <div id="endMessage" style="margin:6px 0 10px 0;"></div>
      <div class="controls">
        <button id="btnPlayAgain" class="btn">Play Again</button>
        <button id="btnShare" class="btn secondary">Share score</button>
      </div>
    </div>
  `;const e=`best_${s}`,i=document.getElementById("best");i.textContent=String(Number(localStorage.getItem(e)||"0"));const a=document.getElementById("canvasHost"),o=Y(s);o.init(a);let c=0;const m=document.getElementById("score");let f=!1,p;o.on("score",d=>{c+=d,m.textContent=String(c)}),o.on("game_over",()=>{const d=Number(localStorage.getItem(e)||"0"),g=c>d;g&&localStorage.setItem(e,String(c));const y=Number(localStorage.getItem(e)||"0");i.textContent=String(y),document.getElementById("finalScore").textContent=String(c);const b=document.getElementById("endMessage");g?b.textContent=`Yess! New best score: ${c} üéâ Now try to beat this one‚Äîhit Play Again.`:b.textContent=`Wooo! You scored ${c} but didn‚Äôt beat your best ${y}. Click Play Again and crush it.`,document.getElementById("endModal").classList.remove("hidden"),E("game_end",{id:s,score:c})}),o.on("share_payload",d=>{p=typeof d=="string"?d:d?.text,console.log("share payload",d)});const v=document.getElementById("btnPause");v.addEventListener("click",()=>{f?(o.resume(),f=!1,v.textContent="Pause"):(o.pause(),f=!0,v.textContent="Resume")}),document.getElementById("btnReset").addEventListener("click",()=>{c=0,m.textContent="0",f=!1,v.textContent="Pause",o.reset(),o.start()}),document.getElementById("btnPlayAgain").addEventListener("click",()=>{c=0,m.textContent="0",f=!1,v.textContent="Pause",document.getElementById("endModal").classList.add("hidden"),o.reset(),o.start()}),document.getElementById("btnShare").addEventListener("click",async()=>{const g=`Just scored ${c} in ${s==="tetris"?"Tetris":s==="snake"?"Snake":s} at Nostalgia Arcade! Can you beat me? üéÆ
Play here: ${location.origin}/`,y=p||g,b=location.origin+"/";if(navigator.share)try{await navigator.share({title:"Nostalgia Arcade",text:y,url:b})}catch{}else await navigator.clipboard.writeText(y),alert("Share text copied to clipboard!");E("share_clicked",{id:s,score:c})}),document.querySelectorAll("#touchControls [data-dir]").forEach(d=>{d.addEventListener("click",()=>{const g=d.dataset.dir,y=new CustomEvent("virtual-direction",{detail:g});window.dispatchEvent(y)})});const x=document.querySelector('#touchControls [data-dir="down"]');let l,h;const u=()=>{l=window.setTimeout(()=>{h=window.setInterval(()=>{const d=new CustomEvent("virtual-direction",{detail:"down"});window.dispatchEvent(d)},60)},200)},I=()=>{l&&(clearTimeout(l),l=void 0),h&&(clearInterval(h),h=void 0)};x.addEventListener("mousedown",u),x.addEventListener("touchstart",u,{passive:!0}),["mouseup","mouseleave","touchend","touchcancel"].forEach(d=>x.addEventListener(d,I)),o.start(),E("game_start",{id:s})}B({"/":T,"/game/:id":z});C(document.getElementById("installPwaBtn"));"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js");S(location.pathname+location.search);
